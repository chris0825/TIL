# CHAPTER 5. 네트워크 계층: 제어 평면

## 5.1 개요
포워딩 테이블이나 플로우 테이블의 생성, 유지 및 설치 과정
- 라우터별 제어: OSPF, BGP 프로토콜
- 논리적 중앙 집중형 제어: 일반화된 매치 플러스 액션 추상화를 통해 별도의 장치로 구현되었던 다양한 기능(부하 분산, 방화벽, NAT) 및 전통적 IP 포워딩 수행

컨트롤러는 잘 정의된 프로토콜을 통해 각 라우터의 제어 에이전트(CA)와 상호작용하여 라우터의 플로우 테이블을 구성 및 관리
CA는 서로 직접 상호작용하지 않으며 포워딩 테이블을 계산하는 데에도 적극적으로 참여하지 않음

## 5.2 라우팅 알고리즘
목표: 송신자부터 수신자까지 라우터의 네트워크를 통과하는 좋은(최소 비용, 가장 빠름, 최조 혼잡) 경로(라우터 패킥의 시퀀스가 지정된 초기 소스 호스트에서 최종 대상 호스트로 이동)를 결정
- 최소 비용 경로 (least-cost path): 출발지에서 목적지까지 거치는 엣지의 가중치 합이 최소인 것
- 최단 경로 (shortest path): 출발지에서 목적지까지 최소 개수의 링크를 포함하는 경로
 ### 중앙 집중형 라우팅 알고리즘 vs 분산 라우팅 알고리즘
 1. 중앙 집중형인가? 분산형인가?
    - 중앙 집중형(LS AL / Dijkstra, Prim): 완전한 정보
    - 분산형     (DV AL / Bellman-Ford  ): 직접 연결된 링크 정보만
 2. 정적 AL인가 동적 AL인가?
    - 정적 라우팅 AL: 아주 느리게 변화, 사람이 개입하여 변화
    - 동적 라우팅 AL: 빠르게 변화, 네트워크 트래픽 또는 토폴로지 변화에 따라 변화
 3. 부하에 민감한가?

### 5.2.1 링크 상태(LS) 라우팅 알고리즘
= 다익스트라 알고리즘(Dijkstra's Algorithm)
(= 프림 알고리즘 Prim's Algorithm)

최악의 경우 O(n^2) 복잡성
진동(oscillation) 문제 가능성

### 5.2.2 거리 벡터(DV) 라우팅 알고리즘
= 벨만-포드 알고리즘 (Bellman-Ford Algorithm)

특징: 분산적, 반복적, 비동기적
단점: Bad news slow distribute -> 포이즌 리버스로 해결(but, 3개 이상 노드에서는 또 해결 불가)

### LS vs DV
| |LS|DV|
|:-:|:-:|:-:|
|메시지 복잡성| O(\|N\|\|E\|) | 변화가 있을 경우에만 전파 |
|수렴 속도| O(\|N\|^2) | OO |
|견고성| 비교적 견고 | 불안정 |

## 5.3 인터넷에서의 AS 내부 라우팅: OSPF
등장 배경
- 확장: 라우터의 수가 증가함에 따라 라우팅 정보의 통신, 계산, 저장에 필요한 오버헤드가 걷잡을 수 없이 증가
- 관리 자율성: 인터넷은 ISP들의 네트워크이고 각 ISP는 자신의 라우터들로 구성된 네트워크를 관리하며 자신의 내부 네트워크 자체 자율 관리

개방형 최단 경로 우선(OSPF) 프로토콜 라우팅
: 라우팅 프로토콜 작동 방식 공개되어 있음
: 링크 상태 정보를 플러딩
: 다익스트라 알고리즘 사용 = 링크 상태 알고리즘
: 전체의 완전한 정보를 필요
: 개별 링크들의 비용 네트워크 관리자가 구성
장점
- 보안, 복수 동일 비용 경로, 단일 AS 내에서 계층 지원

## 5.4 인터넷 서비스 제공업자(ISP) 간의 라우팅: BGP
: 자율 시스템 간 라우팅 프로토콜시 모든 AS 는 경계 게이트웨이 프로토콜(BGP) 사용
: 인터넷에 있는 수천개의 ISP들을 연결하는 프로토콜

### 역할
- CIDR형식으로 표현된 주소의 앞쪽 prefix 향해 전달
- 이웃 AS를 통해 도달 가능한 서브넷 프리픽스 정보 얻음
- 서브넷 주소 프리픽스로의 가장 좋은 경로 결정

### 경로 정보 알리기
- 게이트웨이 라우터: AS의 경계에 있는 라우터로 다른 AS들에 있는 라우터들과 직접 연결됨
- 내부 라우터: 같은 AS에 있는 호스트 및 라우터랑만 연결됨
- 외부 BGP(eBGP): 2개 이상의 AS를 연결하는 BGP 연결
- 내부 BGP(iBGP): 같은 AS내의 라우터간 BGP 연결

### 최고의 경로 결정
- AS-PATH: 알림 메세지가 통화가는 AS들의 리스트
- NEXT-HOP: AS-PATH가 시작되는 라우터 인터페이스의 주소
- 뜨거운 감자 라우팅: 전체 경로는 상관 없고 본인 AS내의 경로만 최소가 되게 다른 AS로 데이터를 넘겨버리려는 라우팅

### 라우팅 정책
AS 라우팅 정책은 다른 모든 고려사항보다 우선시
: 동일 AS 간에는 채택하고 있는 정책이 동일하기 때문에 정책은 고려사항이 되지 않음 그러나,
다른 외부 AS와 라우팅 시 서로 채택하고 있는 정책이 다르기 때문에 이 때는 외부 AS가 채택하고 있는 정책에 부합해야 하는것이 중요
중요도 : 정책 >>>>> 성능

## 5.5 소프트웨어 정의 네트워크(SDN) 평면

### SDN 평면의 특징
- 플로우 기반 포워딩
- 데이터 명면과 제어 평면의 분리
- 네트워크 제어 기능이 데이터 평면 스위치 외부에 존재
- 프로그램이 가능한 네트워크

과거 라우터별 제어구조 시절,
모든 라우터의 소프트웨어를 변경해야하는데, 이때 라우터의 제조사가 다르면 그에 맞게 따로 수정해서 변경
현재 SDN 제어평면 에서는,
컨트롤러의 플로우 테이블만 변경하면 됨

### SDN 컨트롤러
- 통신 계층: 최하단 계층, 제어받는 장치들과 통신
- 네트워크 전역 상태 관리 계층: 중간 계층
- 네트워크 제어 애플리케이션 계층과의 인터페이스: 최상단 계층, 노스바운드 인터페이스를 통해 네트워크 제어 애플리케이션과 소통

### OpenFlow 프로토콜

컨트롤러 -> 제어되는 스위치: 중요 메세지
- 설정: 스위치의 설정 파라미터들을 문의하거나 설정
- 상태 수정: 스위치 플로우 테이블의 엔트리를 추가/제거 또는 수정하거나 스위치 포트의 특성 설정
- 상태 읽기: 스위치 플로우 테이블과 포트로부터 통계 정보와 카운터값을 얻기 위해 사용
- 패킷 전송: 스위치의 지정된 포트에서 특정 패킷을 내보내기 위해 사용

제어되는 스위치 -> 컨트롤러: 중요 메세지
- 플로우 제거: 어떤 플로우 테이블 엔트리가 시간이 만료되었거나 상태 수정 메시지를 수신한 결과로 삭제
- 포트 상태: 포트의 상태 변화
- 패킷 전달: 플로우 테이블의 어떤 엔트리와도 일치하지 않는 패킷은 처리를 위해 컨트롤러에게 전달

### ONOS 컨트롤러
- 노스바운드 추상화와 프로토콜: 애플리케이션이 해당 서비스가 구체적으로 어떻게 구현되는지 몰라도 높은 수준의 서비스를 요청할 수 있게 해줌
- 분산 코어: ONOS는 상호 연결된 서버들의 집합에 서비스로서 설치되는데 이들 서버 각각은 ONOS 소프트웨어의 동일한 사본을 수행
- 사우스바운드 추상화와 프로토콜: 분산 코어가 장치나 프로토콜 종류에 상관없이 동작할 수 있게 함.

## 5.6 인터넷 제어 메세지 프로토콜 (ICMP)
