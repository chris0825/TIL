# Chapter 06. 링크 계층과 근거리 네트워크
## 6.1 링크 계층 소개
**- 노드**: 링크 계층 프로토콜을 실행하는 장치를 의미(ex 호스트, 라우터, 스위치, WIFI, AP 등)<br>
**- 링크**: 통신 경로상의 인접한 노드들을 연결하는 통신 채널<br>
**- 링크 계층 프레임**: 한 링크에서 전송 노드는 데이터 그램을 캡슐화해서 링크로 전송

### 링크 계층이 제공하는 서비스
**- 프레임화:** 네트워크 계층 데이터그램을 링크상으로 전송하기 전에 링크 계층 프레임에 캡슐화 한다.<br>
**- 링크 접속:** MAC 프로토콜은 링크상으로 프레임을 전송하는 규칙을 명시한다.<br>
**- 신뢰적 전달:** 네트워크 계층 데이터그램은 링크상에서 오류 없이 전달된다. 이는 오류율이 높은 링크에서 주로 사용되며 낮은 비트 오류율을 가진 링크에서는 불필요한 오버해드가 될 수 있다.<br>
**- 오류 검출과 정정:** 비트 오류는 신호의 약화나 전자기 잡음 떄문에 발생한다. 송신 노드에서 프레임에 오류 검출 비트를 설정하게 하고 수신 노드에서 오류 검사를 수행하게 함으로써 가능해진다. 오류 정정은 프레임 안의 오류 검출 뿐 만 아니라 프레임의 어느 곳에서 오류가 발생했는지 정확하게 찾아낼 수 있어야 한다.

### 링크 계층이 구현되는 위치
: 링크 계층은 NIC로 알려진 네트워크 어댑터에 구현

## 6.2 오류 검출 및 정정 기술
: 한 노드에서 물리적으로 연결된 이웃 노드로 전송한 링크 계층 프레임 안의 비트 오류 검출과 정정은 데이터 링크 계층에서 제공하는 대표적인 두 가지 서비스이다.
: 오류 검출 비트를 사용하더라도 미검출된 비트 오류가 있을 수 있다.

### 패리티 검사
: 오류를 검출 및 정정하는 수신자의 능력 = FEC (순방향 오류 정정)
- 단일 패리티 검사 (짝수 패리티 기법)
  : 1의 값을 가진 비트가 홀수개 = 최소 1개 이상 비트 오류
  : 1의 값을 가진 비트가 짝수개 = 정상이거나, 최소 2개 이상 짝수개 비트 오류
- 2차원 패리티 기법
  : 수신자 단일 비트 오류의 발생을 검출, 패리티 오류가 있는 열과 행의 인덱스 값을 사용해 잘못된 비트를 실제로 식별해 오류 정정 가능

### 체크섬
: 상대적으로 오버헤드가 적음

### 순환 중복 검사 CRC (= 다항식 코드)
: 링크 계층에서 오류 검출은 어댑터 안의 전요 ㅇ하드웨어로 구현되므로 더 복잡한 연산을 빨리 수행이 가능

## 6.3 다중 접속 링크와 프로토콜
- 점대점 링크: 링크의 한쪽 끝에 한 송신자와 링크의 다른 쪽 끝에 한 수신자가 있다. (ex PPP, HDLC)
- 브로드캐스트 링크: 동일한 하나의 공유된 브로드캐스트 채널에 다수의 송신 노드 및 수신 노드가 연결된다.

### 다중 접속 문제
: 2개 이상의 노드가 동시에 프로엠을 전송하여 충돌이 발생하면 그 신호는 해석도 못할정도로 손실된다.
: 기존 TV는 단방향 브로드캐스트로 이를 해결
: 그러나, 양방향 브로드캐스트를 위해 다중 접속 프로토콜 재정

**다중 접속 프로토콜**
- 채널 분할 프로토콜
- 랜덤 접속 프로토콜
- 순번 프로토콜

###  채널 분할 프로토콜
- TDM 시분할
- FDM 주파수 분할
- CDMA 코드 분할

### 랜덤 접속 프로토콜
: 대신 그 프레임을 재전송하기 전에 랜덤 지연 시간 동안 기다린다.

**알로하 프로토콜, 슬롯 알로하**
- 장점
  : 하나의 활성 노드로 하여금 채널의 전속력으로 계속해서 프레임 전송(FDM과 차이점)
  : 각 노드가 충돌을 감지하고 언제 재전송할지 각자 결정하므로 상당히 분산되어 있음
  : 매우 단순한 프로토콜임
- 단점
  : 활성 노드가 많아질수록 낭비되는 슬롯이 많아짐(효율성 낮아짐)

### CSMA
CSMA, CSMA/CD 프로토콜의 일부
- 말하기 전에 듣는다. (= 캐리어 감지)
- 다른 사람이 동시에 말하기 시작하면 말을 중단한다. (= 충돌 검출)

채널 전파 지연, 신호가 채널의 한쪽 끝에서 다른 쪽 끝으로 전파되는데 걸리는 시간이 CSMA의 성능을 결정하는 중요한 요소

### CSMA/CD

### 순번 프로토콜
: M개의 노드가 활성이면 각 노드가 거의 R/M bps의 처리율을 갖는 프로토콜이 필요해 개발하게 됨
- 폴링 프로토콜
  노드 중 하나를 마스터 노드로 지정하여 각 노드를 라운드 로빈 방식으로 폴링
  충돌 뿐 만 아니라 랜덤 젒고 프로토콜의 단점인 빈 슬롯을 제거함으로써 훨씬 높은 효율을 제공
  단점: 폴링 지연, 마스터 노드가 고장나면 전체 채널 먹통됨
- 토큰 전달 프로토콜 ex) FDDI
  마스터 노드X 대신 토큰이라고 알려진 작은 특수 목적 프레임이 순서대로 노드 간에 전달
  분산 방식이고, 효율이 매우 높음
  단점: 노드 하나가 실패하면 전체 채널 먹통됨, 노드가 잘못해서 토큰을 놓아주지 않으면 토큰이 다시 돌아올 수 있도록 하는 회복 절차가 실행되어야만 함

### DOCSIS
: 하향(CMTS->모뎀) 및 상향(모뎀->CMTS) 네트워크 세그먼트들을 다수의 주파수 채널로 나누기 위해 FDM사용
: 상향 채널은 다수의 모뎀이 하나의 CMTS로의 신호를 전송하기 때문에 충돌 발생 가능성이 하향보다 훨씬 높아 TDM을 사용하여 미니슬롯들로 구성되어 있따.
: 따라서 CMTS는 하향 채널상으로 MAP메시지를 통해 상향 채널로 보낼 데이터가 있는지 확인 후 특정 시간에 어떤 미니슬롯을 통해 전송하면 되는지 명시해준다.

## 6.4 스위치 근거리 네트워크
### MAC = 링크 계층 주소
: 어떤 어댑터도 동일한 주소를 갖지 않는다. (유일함)

### ARP
: 동일한 서브넷상에 있는 호스트나 라우터 인터페이스의 IP주소를 MAC주소로 변환
: ARP테이블(IP주소, MAC주소, TTL)
: 질의 ARP 메시지는 브로드캐스트 프레임으로 전송, 응답 ARP 메시지는 표준 프레임으로 전송
: 플러그 앤 플레이 (= ARP 테이블 자동 구축)

### 서브넷에 없는 호스트에게 네트워크 계층 데이터그램을 전송하려는 상황
1. 목적지로 설정한 경로에 있는 서브넷에 연결된 라우터를 목적지로 설정
2. ARP에게 해당 라우터의 IP주소를 주고 MAC주소를 받아옴
3. 해당 라우터까지 데이터그램 전달
4. 라우터의 포워딩 테이블을 참조하여 새 프레임에 받은 데이터그램을 캡슐화한다
5. 최종 목적지로 설정하여 캡슐화 한 데이터그램을 다시 전송한다.

### 이더넷
**성장 배경**
1. 최초 사용된 고속 랜
2. 토큰링과 FDDI, ATM이 이더넷보다 복잡하고 비쌈
3. 다른 랜들의 새 기술 대응을 완벽하게 해냄
4. 인기가 좋아 필수용품이 돼버림에 따라 저렴해짐
**역사**
1. 1970년 중반 발명 (동축 버스 사용)
2. 80년대~90년대 버스 토폴로지(브로드캐스트 랜, 전송되는 모든 프레임은 버스에 연결된 모든 어댑터를 거치며 이들에 의해 처리됨)
3. 90년 후반 허브(프레임이 아닌 각각의 비트에 대한 처리를 하는 물리 계층 장치) 기반의 스타 토폴로지사용하는 이더넷으로 대체
4. 2000초반 중앙 허브 -> 스위치로 대체

   
