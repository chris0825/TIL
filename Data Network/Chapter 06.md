# Chapter 06. 링크 계층과 근거리 네트워크
## 6.1 링크 계층 소개
- 노드<Br>: 링크 계층 프로토콜을 실행하는 장치를 의미(ex 호스트, 라우터, 스위치, WIFI, AP 등)<br>
- 링크<Br>: 통신 경로상의 인접한 노드들을 연결하는 통신 채널<br>
- 링크 계층 프레임<Br>: 한 링크에서 전송 노드는 데이터 그램을 캡슐화해서 링크로 전송

### 링크 계층이 제공하는 서비스
- 프레임화<Br>: 네트워크 계층 데이터그램을 링크상으로 전송하기 전에 링크 계층 프레임에 캡슐화 한다.<br>
- 링크 접속<Br>: MAC 프로토콜은 링크상으로 프레임을 전송하는 규칙을 명시한다.<br>
- 신뢰적 전달<Br>: 네트워크 계층 데이터그램은 링크상에서 오류 없이 전달된다. 이는 오류율이 높은 링크에서 주로 사용되며 낮은 비트 오류율을 가진 링크에서는 불필요한 오버해드가 될 수 있다.<br>
- 오류 검출과 정정<Br>: 비트 오류는 신호의 약화나 전자기 잡음 떄문에 발생한다. 송신 노드에서 프레임에 오류 검출 비트를 설정하게 하고 수신 노드에서 오류 검사를 수행하게 함으로써 가능해진다. 오류 정정은 프레임 안의 오류 검출 뿐 만 아니라 프레임의 어느 곳에서 오류가 발생했는지 정확하게 찾아낼 수 있어야 한다.

### 링크 계층이 구현되는 위치
: 링크 계층은 NIC로 알려진 네트워크 어댑터에 구현

## 6.2 오류 검출 및 정정 기술
: 한 노드에서 물리적으로 연결된 이웃 노드로 전송한 링크 계층 프레임 안의 비트 오류 검출과 정정은 데이터 링크 계층에서 제공하는 대표적인 두 가지 서비스이다.
: 오류 검출 비트를 사용하더라도 미검출된 비트 오류가 있을 수 있다.

### 패리티 검사
: 오류를 검출 및 정정하는 수신자의 능력 = FEC (순방향 오류 정정)
- 단일 패리티 검사 (짝수 패리티 기법)
  : 1의 값을 가진 비트가 홀수개 = 최소 1개 이상 비트 오류
  : 1의 값을 가진 비트가 짝수개 = 정상이거나, 최소 2개 이상 짝수개 비트 오류
- 2차원 패리티 기법
  : 수신자 단일 비트 오류의 발생을 검출, 패리티 오류가 있는 열과 행의 인덱스 값을 사용해 잘못된 비트를 실제로 식별해 오류 정정 가능

### 체크섬
: 상대적으로 오버헤드가 적음

### 순환 중복 검사 CRC (= 다항식 코드)
: 링크 계층에서 오류 검출은 어댑터 안의 전요 ㅇ하드웨어로 구현되므로 더 복잡한 연산을 빨리 수행이 가능

## 6.3 다중 접속 링크와 프로토콜
- 점대점 링크: 링크의 한쪽 끝에 한 송신자와 링크의 다른 쪽 끝에 한 수신자가 있다. (ex PPP, HDLC)
- 브로드캐스트 링크: 동일한 하나의 공유된 브로드캐스트 채널에 다수의 송신 노드 및 수신 노드가 연결된다.

### 다중 접속 문제
> 2개 이상의 노드가 동시에 프로엠을 전송하여 충돌이 발생하면 그 신호는 해석도 못할정도로 손실<br>
> 기존 TV는 단방향 브로드캐스트로 이를 해결<br>
> 그러나, 양방향 브로드캐스트를 위해 다중 접속 프로토콜 재정

**다중 접속 프로토콜**
- 채널 분할 프로토콜
- 랜덤 접속 프로토콜
- 순번 프로토콜

###  채널 분할 프로토콜
- TDM 시분할
- FDM 주파수 분할
- CDMA 코드 분할

### 랜덤 접속 프로토콜
: 대신 그 프레임을 재전송하기 전에 랜덤 지연 시간 동안 기다린다.

**알로하 프로토콜, 슬롯 알로하**
- 장점<br>
  > 하나의 활성 노드로 하여금 채널의 전속력으로 계속해서 프레임 전송(FDM과 차이점)<br>
  > 각 노드가 충돌을 감지하고 언제 재전송할지 각자 결정하므로 상당히 분산되어 있음<br>
  > 매우 단순한 프로토콜임
- 단점
  > 활성 노드가 많아질수록 낭비되는 슬롯이 많아짐(효율성 낮아짐)

### CSMA
CSMA, CSMA/CD 프로토콜의 일부
- 말하기 전에 듣는다. (= 캐리어 감지)
- 다른 사람이 동시에 말하기 시작하면 말을 중단한다. (= 충돌 검출)

채널 전파 지연, 신호가 채널의 한쪽 끝에서 다른 쪽 끝으로 전파되는데 걸리는 시간이 CSMA의 성능을 결정하는 중요한 요소

### CSMA/CD

### 순번 프로토콜
: M개의 노드가 활성이면 각 노드가 거의 R/M bps의 처리율을 갖는 프로토콜이 필요해 개발하게 됨
- 폴링 프로토콜<br>
  > 노드 중 하나를 마스터 노드로 지정하여 각 노드를 라운드 로빈 방식으로 폴링<br>
  > 충돌 뿐 만 아니라 랜덤 젒고 프로토콜의 단점인 빈 슬롯을 제거함으로써 훨씬 높은 효율을 제공<br>
  단점: 폴링 지연, 마스터 노드가 고장나면 전체 채널 먹통됨
- 토큰 전달 프로토콜 ex) FDDI<br>
  > 마스터 노드X 대신 토큰이라고 알려진 작은 특수 목적 프레임이 순서대로 노드 간에 전달<br>
  > 분산 방식이고, 효율이 매우 높음<br>
  단점: 노드 하나가 실패하면 전체 채널 먹통됨, 노드가 잘못해서 토큰을 놓아주지 않으면 토큰이 다시 돌아올 수 있도록 하는 회복 절차가 실행되어야만 함

### DOCSIS
> 하향(CMTS->모뎀) 및 상향(모뎀->CMTS) 네트워크 세그먼트들을 다수의 주파수 채널로 나누기 위해 FDM사용<br>
> 상향 채널은 다수의 모뎀이 하나의 CMTS로의 신호를 전송하기 때문에 충돌 발생 가능성이 하향보다 훨씬 높아 TDM을 사용하여 미니슬롯들로 구성되어 있다.<br>
> 따라서 CMTS는 하향 채널상으로 MAP메시지를 통해 상향 채널로 보낼 데이터가 있는지 확인 후 특정 시간에 어떤 미니슬롯을 통해 전송하면 되는지 명시해준다.

## 6.4 스위치 근거리 네트워크
### MAC (= 링크 계층 주소)
: 어떤 어댑터도 동일한 주소를 갖지 않는다. (유일함)

### ARP
> 동일한 서브넷상에 있는 호스트나 라우터 인터페이스의 IP주소를 MAC주소로 변환<Br>
> ARP테이블(IP주소, MAC주소, TTL)<br>
> 질의 ARP 메시지는 브로드캐스트 프레임으로 전송, 응답 ARP 메시지는 표준 프레임으로 전송<br>
> 플러그 앤 플레이 (= ARP 테이블 자동 구축)

### 서브넷에 없는 호스트에게 네트워크 계층 데이터그램을 전송하려는 상황
1. 목적지로 설정한 경로에 있는 서브넷에 연결된 라우터를 목적지로 설정
2. ARP에게 해당 라우터의 IP주소를 주고 MAC주소를 받아옴
3. 해당 라우터까지 데이터그램 전달
4. 라우터의 포워딩 테이블을 참조하여 새 프레임에 받은 데이터그램을 캡슐화한다
5. 최종 목적지로 설정하여 캡슐화 한 데이터그램을 다시 전송한다.

### 이더넷
**성장 배경**
1. 최초 사용된 고속 랜
2. 토큰링과 FDDI, ATM이 이더넷보다 복잡하고 비쌈
3. 다른 랜들의 새 기술 대응을 완벽하게 해냄
4. 인기가 좋아 필수용품이 돼버림에 따라 저렴해짐

**역사**
1. 1970년 중반 발명 (동축 버스 사용)
2. 80년대~90년대 버스 토폴로지(브로드캐스트 랜, 전송되는 모든 프레임은 버스에 연결된 모든 어댑터를 거치며 이들에 의해 처리됨)
3. 90년 후반 허브(프레임이 아닌 각각의 비트에 대한 처리를 하는 물리 계층 장치) 기반의 스타 토폴로지를 사용하는 이더넷으로 대체
4. 2000초반 중앙 허브 -> 스위치로 대체

**이더넷 프레임의 6개 필드**
- 데이터 필드<br>: IP 데이터그램을 운반
- 목적지 주소<br>: 목적지 어댑터의 MAC주소를 포함
- 출발지 주소<br>: 프레임을 랜으로 전송하는 어댑터의 MAC주소를 포함
- 타입 필드<br>: 네트워크 계층 프로토콜을 다중화하도록 허용
- CRC<br>: 프레임에 오류가 생겼는지 검출
- 프리앰블<br>: 수신 어댑터를 깨우는 첫 7바이트, 수신자의 클록을 송신자의 클록과 동기화하는 1바이트, 총 8바이트로 구성

### 스위치
- 필터링<br>: 프레임을 인터페이스로 전달할지 또는 폐기할지 결정하는 스위치의 기능
- 포워딩<br>: 프레임이 전송될 인터페이스를 결정하고 프레임을 해당 인터페이스로 내보내는 기능

**스위치 테이블**
: 스위치의 필터링과 포워딩은 스위치 테이블을 이용
1. MAC 주소
2. 그 MAC 주소로 가게 하는 스위치 인터페이스
3. 해당 엔트리가 테이블에 만들어진 시점에 대한 정보

### 스위치의 자가학습
1. 스위치 테이블은 초기 EMPTY상태
2. 인터페이스로 수신한 각 프레임에 대한 정보를 테이블에 기록
3. 수명 시간이 지난 후에도 스위치가 테이블에 기록해둔 출발지의 신호를 받지 못하면 삭제<br>
네트워크 관리자나 사용자의 개입을 요구하지 않음 = **플러그 앤 플레이 장치**

### 스위치의 특징 - 장점
- 충돌 제거<br>: 충돌로 인해 낭비되는 대역폭이 없음
- 이질적인 링크들<br>: 링크들을 별개로 분리하기 때문에 랜의 각 링크는 상이한 속도로 동작이 가능 = 상이한 매체 사용 가능
- 관리<br>: 향상된 보안 + 쉬운 네트워크 관리

### 스위치 vs 라우터
||스위치|라우터|
|:-:|:-:|:-:|
|장점|**플러그 앤 플레이**<br>**상대적으로 높은 패킷 필터링 및 전달률**|네트워크에 중복된 경로가 있더라도 패킷은 라우터를 따라 순환하지 않으므로 **최상의 경로**를 사용<br>스패닝 트리와 같은 제한이 없어 **인터넷 토폴로지가 자유롭게 구축**<br>2계층에서의 브로드캐스트 폭풍에 대비한 **방화벽 보호** 기능|
|단점|브로드캐스트 프레임의 순환을 방지하기 위해 스위치 네트워크의 실제 사용되는 토폴로지는 **스패닝 트리로 제한**<br>**상당한 양의 ARP 트래픽 생성되고 처리됨**<br>브로드캐스트 트래픽의 폭주에 대비한 방안을 제공하지 않아 **전체 네트워크 중단 가능성** 존재|**플러그 앤 플레이가 아님**<br>3계층 필드까지 처리해야 하므로 **스위치보다 패킷당 처리 시간이 더 큼**<br>**발음과 관련해 사람들은 많은 시간을 낭비**함|
|사용처|작은 네트워크<br>(트래픽이 지역적으로 제한, IP주소의 구성 요구X, 총 처리율 증가)|큰 네트워크<br>(트래픽을 좀 더 확실히 격리, 브로드캐스트 트래픽 폭주 제어, 최적 경로 사용)|
= 작은 네트워크는 스위치만으로도 충분하지만, 큰 네트워크는 스위치 + 라우터까지 사용해야함.

### VLAN
스위치 계층 구조의 단점을 보완
- 트래픽 격리의 부족<br>: 계층구조는 그룹 트래픽을 단일 스위치 내로 격리하지만, 브로드캐스트 트래픽은 여전히 전체 네트워크로 전달됨<br>: 브로드캐스트 트래픽의 전달 범위를 제한하면 랜 성능을 향상시킬 수 있을 뿐 만 아니라 (개인)보안을 위해서도 제한할 필요성 존재
- 스위치의 비효율적인 사용<br>: 첫 단계 스위치가 그룹수만큼 필요한데, 이때 그룹 내 인원이 10명 이상이면 추가적으로 스위치가 더 필요
- 사용자 관리<br>: 사용자의 그룹 이동 시 물리적 케이블 연결을 변경해야 하는데 이때 사용자가 두 그룹 이상 속한 사용자면 속한 그룹수에 비례해 과정이 복잡해진다.

VLAN을 완벽하게 격리함으써 새로운 어려움(트래픽 분배)이 생김
트래픽 분배를 위해서는 각 스위치를 연결시켜야 하는데 가장 쉬운 방법으로는 각 스위치의 포트 하나씩 다른 그룸과 연결하면 된다.
이때, N개의 스위치 포트를 항상 다른 스위치와 연결하는 데 사용해야 하므로 **확장 문제**가 발생.
⬇️
이를 보완하기 위해 **VLAN 트렁킹**을 사용
각 스위치마다 특수 포트를 구성하여 확장

VLAN 태그 = TPID + 태그 제어정보
: 프레임이 속한 VLAN을 식별별

## 6.5 링크 가상화
: 링크 계층으로서의 네트워크

### MPLS 다중 프로토콜 레이블 스위칭
특징
- 트래픽 관리기능
- 빠른 복구
- VPN 구현

